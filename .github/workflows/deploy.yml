name: Manual Trigger Workflow

on:
  workflow_dispatch: # 수동 실행 이벤트

jobs:
  run-job:
    runs-on: ubuntu-latest # 워크플로를 실행할 환경 설정

    env:
      AUTHORIZED_USERS_IN_MAIN: "JaegyeongCoconut" # main branch 배포 권한이 있는 사용자 정의. ,로 구분
      AUTHORIZED_USERS_IN_DEVELOP: "JaegyeongCoconut" # develop branch 배포 권한이 있는 사용자 정의. ,로 구분

    steps:
      # main 또는 develop이 아닌 브랜치일 때 실패 처리
      - name: Check branch condition
        if: ${{ github.ref != 'refs/heads/main' && github.ref != 'refs/heads/develop' }}
        run: |
          echo "::error:: main 또는 develop 브랜치에서만 실행 가능합니다."
          exit 1

      # 브랜치에 따른 권한 확인 및 실행
      - name: Authorization check
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/develop" ]]; then
            AUTHORIZED_USERS=$AUTHORIZED_USERS_IN_DEVELOP
            BRANCH_NAME="develop"
          elif [[ "${{ github.ref }}" == "refs/heads/main" ]]; then
            AUTHORIZED_USERS=$AUTHORIZED_USERS_IN_MAIN
            BRANCH_NAME="main"
          fi
          echo "Authorized users for $BRANCH_NAME branch: $AUTHORIZED_USERS"
          if [[ ! ",$AUTHORIZED_USERS," =~ ",${GITHUB_ACTOR}," ]]; then
            echo "::error:: You are not authorized to deploy to the $BRANCH_NAME branch."
            exit 1
          fi
          echo "$BRANCH_NAME branch workflow triggered by ${{ github.actor }}"
